<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Humanities Graph Viewer</title>
  <!-- Cytoscape.js from CDN -->
  <script src="https://unpkg.com/cytoscape@3.23.0/dist/cytoscape.min.js"></script>
  <style>
    body, html { margin: 0; padding: 0; height: 100%; width: 100%; }
    #cy { width: 100%; height: 100%; display: block; }
  </style>
</head>
<body>
  <div id="cy"></div>

  <script>
  // Configuration: set your API base URL here
  const API_BASE = 'https://an-leabharlann-ghealach.onrender.com';

  async function fetchGraph() {
    // Assumes API returns { nodes: [{id, label, ...}], relationships: [{id, source, target, type, ...}] }
    const res = await fetch(`${API_BASE}/graph`);
    if (!res.ok) throw new Error('Failed to fetch graph');
    return res.json();
  }

  function mapToCytoscapeElements({ nodes, relationships }) {
    const cyNodes = nodes.map(n => ({
      data: {
        id: n.id,
        label: n.title || n.name || n.id,
        group: n._labels || n.labels // optional: labels from API
      }
    }));
    const cyEdges = relationships.map((r, i) => ({
      data: {
        id: r.id || `e${i}`,
        source: r.source,
        target: r.target,
        label: r.type || r.relType
      }
    }));
    return [...cyNodes, ...cyEdges];
  }

  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const graph = await fetchGraph();
      const elements = mapToCytoscapeElements(graph);

      const cy = cytoscape({
        container: document.getElementById('cy'),
        elements,
        style: [
          { selector: 'node', style: { 'label': 'data(label)', 'text-valign': 'center', 'color': '#000', 'background-color': '#fafafa', 'border-width': 1, 'border-color': '#999', 'width': 'label', 'height': 'label', 'padding': '10px' } },
          { selector: 'edge', style: { 'label': 'data(label)', 'curve-style': 'bezier', 'target-arrow-shape': 'triangle', 'width': 1, 'line-color': '#888', 'target-arrow-color': '#888', 'font-size': '8px' } }
        ],
        layout: { name: 'cose', animate: false }
      });
    } catch (err) {
      console.error(err);
      document.body.innerHTML = `<p style="color:red; text-align:center;">${err.message}</p>`;
    }
  });
  </script>
</body>
</html>
